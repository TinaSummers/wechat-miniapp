!function(){var __eV="1.1.6",__eC,__rU="https://apitrack.woaap.com/api/track/miniapplog",__rD=3e3,__k_pub="etrack",__k_pri="etdsdk_",__dD={},__rC=0,__rC=0,__lD={},__u={o:function(o){return __u.j(o,"Object")?Object.keys(o).filter(function(e){return __u.j(e,"String")&&/^[a-zA-Z0-9_]{1,32}$/.test(e)&&(__u.j(o[e],"String")||__u.j(o[e],"Number"))}).map(function(e){return{k:""+e,v:""+o[e],t:__u.j(o[e],"String")?"string":"number"}}):[];var n},os:function(o){return __u.j(o,"Object")?Object.keys(o).map(function(e){return{k:e,v:o[e]}}):[]},s:{set:function(n,v){try{return wx.setStorageSync(__k_pri+n,v),!0}catch(error){return!1}},get:function(n){try{return wx.getStorageSync(__k_pri+n)}catch(error){return!1}},remove:function(n){try{return wx.removeStorageSync(__k_pri+n),!0}catch(error){return!1}}},ts:function(){return(new Date).getTime()},u:function(l,r){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uu=[],i;for(r=r||16,l=l||32,i=0;i<l;i++)uu[i]=chars[0|Math.random()*r];return uu.join("")},r:function(l,r){if(r=r||16,(l=l||32)<24)return this.u(l,r);var _b=this.u(l-13,r).split(""),_s=this.ts().toString().split("");_b.length<_s.length&&(_s=(_b=[_b,_s])[0],_b=_b[1]);for(var i=0;i<_s.length;i++)_b.splice(2*i,0,_s[i]);return _b.join("")},req:function(d){if(!d||!d.data)return console.error("SDK损坏，请联系客服或重新下载"),!1;d.data.v=__eV,d.data.k=__eC.appKey,d.data.c=++__rC,d.data.t=__u.ts(),wx.request({url:d.url,data:d.data,header:Object.assign({"content-type":"application/json"},d.header||{}),method:d.method||"POST",dataType:d.dataType||"json",success:function(res){__dD.si&&"devtools"===__dD.si.platform&&res.data&&res.data.code&&console.warn("etocrm微信小程序统计SDK已更新，请下载使用最新版本")},fail:function(error){d.fail&&d.fail(error)}})},j:function(e,t){return"[object "+t+"]"==={}.toString.call(e)}},__eH={applyUser:function(d){var data={},_data=__u.s.get("user")||{};data.u=d.unionId,data.o=d.openId,data.m=d.mobile&&d.mobile.toString(),__u.j(data.u,"String")&&data.u.length<50&&(_data.u=data.u)||delete data.u,__u.j(data.o,"String")&&data.o.length<50&&(_data.o=data.o)||delete data.o,__u.j(data.m,"String")&&data.m.length<16&&(_data.m=data.m)||delete data.m,Object.keys(data).length&&(__u.s.set("user",_data),__lD.u=_data)&&__rpH({tv:"event",tl:""})},applyEvent:function(e){if(e&&__u.j(e,"String")&&/^[a-zA-Z][a-zA-Z0-9_]{0,31}$/.test(e)){var t,r=arguments[1]?arguments[1]:{},n=Object.keys(r).filter(function(e){return __u.j(n=e,"String")&&/^[a-zA-Z0-9_]{1,32}$/.test(n)&&(t=r[e],__u.j(t,"String")||__u.j(t,"Number"))}).map(function(e){return{k:""+e,v:""+r[e],t:__u.j(r[e],"String")?"string":"number"}});__rpH({tv:"event",tl:e,te:n})}}},__aH={onShow:function(o){__lD.ao={},__lD.ao.path=o.path||"",__lD.ao.query=__u.os(o.query||{}),__lD.ao.scene=o.scene||0,o.referrerInfo&&o.referrerInfo.appId?__lD.ao.referrerInfo=o.referrerInfo:delete __lD.ao.referrerInfo,__rpH({tv:"app",tl:"show"})},onHide:function(){__rH({tv:"app",tl:"hide"},1)},onError:function(error){error&&(error.length>255&&(error=error.substr(0,255)),__rpH({tv:"app",tl:"error",te:__u.o({errMsg:error})},1))},onPageNotFound:function(error){__rpH({tv:"app",tl:"404",te:__u.o({path:error.path,isEntryPage:error.isEntryPage.toString()})},1)}},__pH={onLoad:function(o){__lD.q=__u.os(o),__lD.u=__u.s.get("user")||null},onShow:function(){__lD.p=this.route||this.__route__,__lD.ao||(__lD.ao=null),__rpH({tv:"page",tl:"show"})},onHide:function(){__rH({tv:"page",tl:"hide"},1)},onUnload:function(){__rH({tv:"page",tl:"hide"},1)}},__sH={onShareAppMessage:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r={from:e.from,path:t.path||""};return t.title?r.title=""+t.title:r.title="",e.target&&(r.target=JSON.stringify(e.target)),__rH({tv:"page",tl:"share",te:__u.o(r)},1),t}},__cH_onLoad=function(){},__cH_onShow=function(){},__cH_onUnload=function(){},__cH_onHide=function(){},__bC=function(l,a,h){var n=a[l];a[l]=function(o){h.call(this,o),n&&n.call(this,o)}},__sU=function(){return new Promise(function(r,j){var n="";(n=__u.s.get("uuid"))||__eC.uuid&&(n=__eC.uuid,__u.s.set("uuid",__eC.uuid)),n||(n=__u.r())&&(__u.s.set("uuid",n),__eC.uuid=n),r(n)})},__sT=function(){return new Promise(function(r,j){var n="";__eC.b&&(n=__eC.b),!n&&(n=__u.r())&&(__eC.b=n),r(n)})},__pD,__gD=function(){return __pD||(__pD=Promise.all([__sU(),new Promise(function(s,j){var u=__u.s.get("userInfo"),r=__u.j(u,"Object")?u:null;wx.getSetting({success:function(res){res.authSetting&&res.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){delete e.userInfo.errMsg,__u.s.set("userInfo",e.userInfo),s(Object.assign(r||{},e.userInfo))},fail:function(){s(r)}}):s(r)},fail:function(){s(r)}})}),new Promise(function(s,j){wx.getSystemInfo({success:function(e){delete e.errMsg,s(e)},fail:function(e){s(null)}})}),new Promise(function(s,j){wx.getNetworkType({success:function(e){delete e.errMsg,s(e)},fail:function(e){s(null)}})}),new Promise(function(s,j){var u=__u.s.get("location"),r=__u.j(u,"Object")?u:null;wx.getSetting({success:function(res){res.authSetting&&res.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function(e){delete e.errMsg,__u.s.set("location",e),s(e)},fail:function(e){s(null)}}):s(r)},fail:function(){s(r)}})}),__sT()]).then(function(e){__dD.uu=e[0],__dD.ui=e[1],__dD.si=e[2],__dD.nw=e[3],__dD.l=e[4],__dD.b=e[5]}))},__rH=function(e,n,r){var d=Object.assign({},e,__lD);return __rP(d,n,r)},__rpH=function(e,n,r){var d=Object.assign({},e,__lD);return __gD().then(function(){__rP(d,n,r)})},__rP=function(r,n,c){var d=Object.assign({},__dD,r);n&&(d.ao=null,d.q=[],d.l=null,d.nw=null,d.si=null,d.ui=null,d.u=null),d.b||(d.b=""),c?-1==d.b.indexOf("-retry")&&(d.b+="-retry"):d.b=d.b.replace("-retry","");var rd={url:__rU,data:d,fail:function(e){c||setTimeout(()=>{__rP(r,n,1)},3e3)}};__u.req(rd)},__init;(function(){try{if(!__eC&&!(__eC=require("./etd-sdk.conf.js")).appKey)return console.error("请在etd-sdk.conf.js文件中设置appKey字段"),"error-sdk-config"}catch(error){return console.error("请把etd-sdk.conf.js文件拷贝到utils目录中"),"error-sdk-config"}var e,_App=App,_Page=Page,fakeA=function(a){a[__k_pub]=__eH,Object.keys(__aH).forEach(function(l){__bC(l,a,__aH[l])}),_App(a)},fakeP=function(a){Object.keys(__pH).forEach(function(l){__bC(l,a,__pH[l])}),Object.keys(__sH).forEach(function(l){var _o=a[l],_s=__sH[l];a[l]=function(res){var h=_o&&_o.call(this,res);return _s.call(this,res,h)}}),_Page(a)};__eC.usePlugin?module.exports={App:fakeA,Page:fakeP}:(App=fakeA,Page=fakeP)})()}();